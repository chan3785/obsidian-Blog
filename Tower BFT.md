
### 날짜 : 2024-04-15 00:52

### 주제: #BFT #pBFT #TowerBFT 

---
### 메모: 
### BFT (Byzantine Fault Tolerance): 
비잔틴 장애 허용은 블록체인에서 네트워크가 장애가 발생하지 않고 계속해서 유지될 수 있도록 하는 것에 초점을 맞춘다.
이름에서부터 장애 허용은
어느 정도의 장애가 발생해도 그것을 허용하고 네트워크를 유지시킨다는 뜻이다.

이게 어떻게 가능하게 동작하느냐는 의문을 가질 수 있다.

그래서 블록체인은 채굴자에게 보상을 주는 방법으로 해결을 했다.

간략히 요약하자면,
1. 블록체인은 네트워크를 계속해서 유지 시키는 것이 목적이다.
2. 채굴자는 보상을 얻기 위해 정직하게 검증에 참여해야 한다. 
3. 만약 나쁜 마음을 먹고 의도적으로 가짜 정보를 퍼트리려고 해도 다른 많은 사람들은 보상을 얻기 위해 정직하게 검증에 참여하므로 다수의 노드가 정직한 검증이라고 할 수 있다.
4. 그래서 나쁜 노드가 장애를 일으켜도 그것을 허용해도 되는 게 비잔틴 장애 허용이다.

PoS, PoW 등에서 합의를 도출해내는 검증 과정은
트랜잭션 뭉치를 블록으로 만드는데 
P2P로 서로 트랜잭션을 검증을 한다. 
그런데 이 때 중요한 개념이 있는데, 바로 트랜잭션의 내용과 시기가 일치하는지를 확인하는 것이다.
따라서 오프체인의 시간 개념이 아니라 온체인 내에서의 블록체인 시계가 필요한 것이다.

비트코인과 이더리움은 트랜잭션에 남는 시간을 계산한 정보를 서로 비교한다.
따라서 필수적으로 P2P 네트워크를 활용해야 하고 검증하는 과정에서 굉장히 복잡한 네트워크가 형성이 되게 된다. 
그렇기 때문에 시간이 오래 걸리는 것이다.

이걸 해결하는 방식이 바로 PoH이다.

PoH 방식은 트랜잭션을 해시화 할 때 순서를 기록을 한다고 그랬나?
사실 잘 이해 못 했다
대충 느낌으로만 설명하자면

트랜잭션에 순서가 모두 남기 때문에 
검증인이 검증을 할 때 
다른 Peer와 소통을 할 필요가 없이 독립적으로 검증을 수행해 낼 수 있기 때문에 시간이 엄청 단축되는 것이다.

### pBFT (Practical Byzantine Fault Tolerance):
PBFT는 BFT를 구현한 방법 중 하나

BFT는 이론적인 개념이고 PBFT는 실제로 구현을 한 알고리즘이다.

PBFT는 노드의 수가 적을 때 용이한 합의 알고리즘인데, 그 이유는 다음과 같다.

1. PBFT에서는 리더노드와 보조노드가 있다. 리더노드 1명을 제외한 나머지는 보조노드가 된다. 리더노드는 누구나 될 수 있다. 리더노드에 결함이 발생하면 보조노드가 리더노드가 된다.
2. PBFT는 규칙이 있는데, 노드끼리 서로 메시지를 주고 받는다. 그 메시지가 누구에게서 왔는지, 내용이 변하진 않았는지 확인해야 한다는 규칙이 있다.
3. 한 마디로, 네트워크에 참여한 노드를 모두 미리 알고 있어야 한다.

그러면 작동 방식에 대해 설명하겠다.
1. 참가자 1명이 리더가 되면 자신을 포함한 구성원 모두에게 트랜잭션에 대한 요청을 보낸다.
2. 그 요청에 대한 결과를 집계해서 다수의 값을 따라서 블록을 만들고 확정한다.

PBFT는 수학적으로 증명이 된 알고리즘인데
악의적인 노드 수가 1/3 이상 (33%)이 될 수 없다고 가정한다.

그게 무슨 뜻이냐 하면
똑똑한 수학자들이 증명을 한 내용이다.
나쁜 노드의 수가 n이라 했을 때, 전체 노드의 수가 3n+1 이상이면 그 합의는 신뢰할 수 있다는 것을 수학적으로 증명을 한 것이다.
그리고 합의 확정에는 n+1개 이상의 노드가 필요하다.

만약 나쁜 노드가 1개가 있으면, 그 합의가 신뢰할 수 있게 되기 위해서 최소한 노드 4개가 필요하다.
그리고 확정에는 2개 이상의 노드가 필요하다.
다시 확실하게 말해서, f개의 나쁜 노드가 있다고 가정을 하면 3개가 있다고 가정을 해보자.
그러면 신뢰가 보장되는 합의를 확정하기 위해선 정상인 노드가 최소 4개가 필요하다는 뜻이다.

전체 노드의 수가 3f + 1 (f = fault) 이상임이 전제 조건이므로 
나쁜 노드의 수는 33% 이상이 절대 될 수 없다.
그리고 기본적으로 문제는 개개인의 노드에서 발생을 하고 그 문제가 발생한 노드에서 잘못된 내용의 메시지를 보낼 수 있다고 가정한다.

이건 PBFT 규칙에 의해서 설명이 된다.

메시지를 누가 보냈는지 확인을 해야 하고
누군가 메시지를 변조시키지 않았음을 확인 했을 거기 때문에
노드 자체가 오류가 발생했고, 그래서 잘못된 내용을 보냈다고 할 수 있다.

pBFT 방식은 $\frac{2}{3}$ 이상의 노드가 합의하면 검증이 되기 때문에 속도가 향상된다고 볼 수 있다.
### Tower BFT
타워 BFT는 PBFT의 파생형이다.
일반적인 PBFT와는 다른 점이 바로 PoH를 글로벌 시간으로 이용한다는 점이다.

타워 BFT는 이름에서 그 핵심을 나타낸다.
노드들은 어느 한 해시, 그러니까 특정 시점이 옳고 그른지 투표를 할 수 있다.
투표를 하면 타임 아웃이라는 게 생기는데, 이게 무엇이냐 하면
time-out이란? 시간이 초과가 되면 뿌왕이란 느낌
여기 타워 bft에서 time-out은 
### 출처(참고문헌)
- http://wiki.hash.kr/index.php/%ED%94%84%EB%9E%99%ED%8B%B0%EC%BB%AC_%EB%B9%84%EC%9E%94%ED%8B%B4_%EC%9E%A5%EC%95%A0_%ED%97%88%EC%9A%A9
- https://kr.beincrypto.com/learn-kr/%EC%95%8C%EA%B8%B0-%EC%89%BD%EA%B2%8C-10%EA%B0%80%EC%A7%80%EB%A1%9C-%EC%A0%95%EB%A6%AC%ED%95%9C-%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8-%ED%95%A9%EC%9D%98-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98/
- https://blog.naver.com/bcexkorea/221438799103
- https://medium.com/solanakorea/%ED%83%80%EC%9B%8C-bft-%EC%86%94%EB%9D%BC%EB%82%98%EC%9D%98-%EA%B3%A0%EC%84%B1%EB%8A%A5-pbft-18faa4d46ab9
- https://docs.solanalabs.com/implemented-proposals/tower-bft
- https://4pillars.io/ko/articles/solana-mega-report-like-apple-but-unlike-apple/public

### 연결문서
-